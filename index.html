<html>
<head>
	<script src="src/math/common.js"></script>
	<script src="src/math/mat2.js"></script>
	<script src="src/math/mat2d.js"></script>
	<script src="src/math/mat3.js"></script>
	<script src="src/math/mat4.js"></script>
	<script src="src/math/vec2.js"></script>
	<script src="src/math/vec3.js"></script>
	<script src="src/math/vec4.js"></script>
	<script src="src/math/quat.js"></script>

	<script src="src/image.js"></script>

	<script src="src/firstpersoncontroller.js"></script>

	<script src="src/gl/shader.js"></script>
	<script src="src/gl/camera.js"></script>
	<script src="src/gl/texture.js"></script>
	<script src="src/gl/renderer.js"></script>

	<script src="src/terrain.js"></script>
	<script src="src/cube.js"></script>
	<script src="src/application.js"></script>
</head>

<body onload="Application.Run(60);">
	<div id="vertex-shader" hidden>
		precision mediump float;

		attribute vec3 position;
		attribute vec3 normal;
		attribute vec2 uvs;

		varying vec3 normal_out;
		varying vec2 uvs_out;
		varying vec4 position_out;

		uniform mat4 viewProjection;
		uniform mat4 model;
		uniform mat4 inverseView;

		void main()
		{
			mat4 modelViewProj = viewProjection * model;
			normal_out = normalize(inverseView * vec4(normal, 1.0)).xyz;
			uvs_out = uvs;
			position_out = modelViewProj * vec4(position.xyz, 1.0);
			gl_Position = position_out;
		}
	</div>

	<div id="fragment-shader" hidden>
		precision mediump float;

		varying vec3 normal_out;
		varying vec2 uvs_out;
		varying vec4 position_out;

		uniform vec3 lightPosition;

		void main()
		{
			vec3 lightDir = position_out.xyz - lightPosition;
			float dist = length(lightDir);
			float t = max(dot(normal_out, lightDir / dist), 0.0);
			float falloff = 1.0 / sqrt(dist);
			vec3 color = vec3(0.1, 0.1, 0.1) + vec3(1, 0, 0) * t * falloff;	
			gl_FragColor = vec4(color, 1.0);
		}
	</div>

	<canvas id="gl-canvas" style="border: none;" width="1280" height="720"></canvas>
	<canvas id="dummy-canvas" hidden></canvas>
</body>

</html>